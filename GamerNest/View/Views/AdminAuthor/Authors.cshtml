@model Support.ModelList
@{
    ViewData["Title"] = "Admin - Authors";
}

<partial name="_LateralMenu"/>


<main class="home-section">
    <div class="text">
        <h1>Authors</h1>

        <h3>This is the Users tab. all registered users information will be displayed here.</h3>

        <div class="filter">
            <h4>Filters:</h4>
            <form asp-controller="AdminAuthor" asp-action="Authors">
                <div class="form-row">
                    <label for="id">ID:</label>
                    <input type="number" id="id" name="id" pattern="[0-9]+" required>
                </div>
                <div class="form-row">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" pattern="[A-Za-z]+" required>
                </div>
                <div class="form-row">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-row">
                    <label for="isAdmin">Is Admin:</label>
                    <input type="checkbox" id="isAdmin" name="isAdmin">
                </div>
                <div class="form-row">
                    <label for="isActive">Is Active:</label>
                    <input type="checkbox" id="isActive" name="isActive">
                </div>
                <input class="filtButton" type="submit" value="Filter">
            </form>
        </div>

        <div class="adminTable">
            <table>
                <tr>
                    <th>Actions</th> <!-- Added "Actions" column header -->
                    @foreach ( var prop in Model.authorList.First().GetType().GetProperties() )
                    {
                        // Exclude "Password" column from table
                        if ( prop.Name.ToLower() != "password" )
                        {
                            <th>@prop.Name</th>
                        }
                    }
                </tr>
                @foreach ( var item in Model.authorList )
                {
                    <tr>
                        <td>
                            <!-- Delete Author -->
                            <a id="deleteAction_@item.id" class="delete-action" onclick="deleteModal(@item.id)">
                                <i class="fa-solid fa-trash-can"></i>
                            </a>

                            <!-- Edit Author -->
                            <a asp-controller="AdminAuthor" asp-action="EditAuthor" asp-route-id="@item.id">
                                <i class="fa-solid fa-pen"></i>
                            </a>

                            <!-- Modal -->
                            <div id="confirmationModal_@item.id" class="modal">
                                <div class="modal-content">
                                    <h2>Confirmation</h2>
                                    <p>Are you sure you want to delete this row with id: @item.id?</p>
                                    <div class="modal-actions">
                                        <button id="confirmBtn_@item.id" asp-controller="AdminAuthor" asp-action="DeleteAuthor" data-row-id="@item.id">Delete</button>
                                        <button id="cancelBtn_@item.id">Cancel</button>
                                    </div>
                                </div>
                            </div>



                        </td>
                        @foreach ( var prop in item.GetType().GetProperties() )
                        {
                            // Exclude "Password" column from table
                            if ( prop.Name.ToLower() != "password" )
                            {
                                <td>
                                    @if (prop.PropertyType == typeof(bool))
                                    {
                                        @if ((bool)prop.GetValue(item))
                                        {
                                            <i class="far fa-circle-check checkmark-icon"></i>
                                        }
                                        else
                                        {
                                            <i class="far fa-circle-xmark xmark-icon"></i>
                                        }
                                    }
                                    else if (prop.PropertyType == typeof(string) && ((string)prop.GetValue(item))?.StartsWith("/img/") == true)
                                    {
                                        <img class="image-cell" src="@prop.GetValue(item)" alt="Image">
                                    }
                                    else
                                    {
                                        var propValue = prop.GetValue(item)?.ToString();
                                        if ( !string.IsNullOrEmpty( propValue ) )
                                        {
                                            if ( propValue == "ENG" )
                                            {
                                                <span class="fi fi-gb fis"></span>
                                            }
                                            else if ( propValue == "ESP" )
                                            {
                                                <span class="fi fi-es fis"></span>
                                            }
                                            else
                                            {
                                                @propValue
                                            }
                                        }
                                    }
                                </td>
                            }
                        }
                    </tr>
                }
            </table>
        </div>

        <div class="pagination">

            <div>
                @if ( Model.CurrentPage > 1 )
                {
                    <!-- Previus Page -->
                    <a asp-controller="AdminAuthor" asp-action="Authors" asp-route-page="@(Model.CurrentPage - 1)" asp-route-pageSize="@Model.PageSize">Previous</a>
                }

                @if ( Model.CurrentPage < Math.Ceiling( (double) Model.TotalItems / Model.PageSize ) )
                {
                    <!-- Next page -->
                    <a asp-controller="AdminAuthor" asp-action="Authors" asp-route-page="@(Model.CurrentPage + 1)" asp-route-pageSize="@Model.PageSize">Next</a>
                }
            </div>
            <div>
                <p>
                    Page @Model.CurrentPage of @Math.Ceiling((double)Model.TotalItems / Model.PageSize) (@Model.authorList.Count out of @Model.TotalItems)
                  </p>
            </div>
        </div>
        
    </div>
</main>